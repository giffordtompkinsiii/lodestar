# Core API https://data.bloomberglp.com/professional/sites/10/2017/03/BLPAPI-Core-Developer-Guide.pdf
# Python Documentaion https://bloomberg.github.io/blpapi-docs/python/3.18/_autosummary/blpapi.Request.html

import blpapi as bb 

options = bb.SessionOptions()
options.setServerHost('localhost')
options.setServerPort(8194)

session = bb.Session(options)
session.start() 

# session.openService("//blp/refdata")
# refDataService = session.getService("//blp/refdata")
# request = refDataService.createRequest("ReferenceDataRequest")
# request.append("securities", "IBM US Equity")
# request.append("securities", "/cusip/912828GM6@BGN")
# request.append("fields", "PX_LAST")
# request.append("fields", "DS002")
# session.sendRequest(request, None)


assets = ['A',
'AAL',
'AAPL',
'ABBV',
'ABC',
'ABT',
'ACC',
'ACN',
'ADBE',
'ADI',
'ADP',
'ADSK',
'AFL',
'AGN',
'AIG',
'AKAM',
'ALB',
'ALGN',
'ALL',
'ALXN',
'AMAT',
'AMD',
'AME',
'AMGN',
'AMP',
'AMRN',
'AMT',
'AMTD',
'AMZN',
'ANOAX',
'ANTM',
'AON',
'APD',
'APH',
'APTV',
'ASGN',
'ASML',
'ASR',
'ATVI',
'AVB',
'AVGO',
'AXP',
'AYI',
'AZO',
'BA',
'BABA',
'BAC',
'BAX',
'BAYRY',
'BBGI',
'BBY',
'BDX',
'BECN',
'BERY',
'BHP',
'BIDU',
'BIIB',
'BIOQ',
'BLK',
'BLL',
'BMA',
'BMO',
'BMRN',
'BMY',
'BOKF',
'BP',
'BRK',
'BRKB',
'BRK B',
'BSX',
'BTC',
'BTI',
'BWA',
'BYND',
'C',
'CACI',
'CAG',
'CAH',
'CAL',
'CASH',
'CAT',
'CB',
'CBRE',
'CCI',
'CDW',
'CEF',
'CEPU',
'CFG',
'CHTR',
'CI',
'CINF',
'CL',
'CLF',
'CLX',
'CMCSA',
'CME',
'CMG',
'CMI',
'CNC',
'CNP',
'COF',
'COR',
'COST',
'CQP',
'CRCM',
'CRDE',
'CRESY',
'CRM',
'CRSP',
'CRUS',
'CSCO',
'CSIQX',
'CSX',
'CTAS',
'CTVA',
'CTXS',
'CVE',
'CVHSY',
'CVS',
'CVVIF',
'CVX',
'CWBHF',
'D',
'DAL',
'DAN',
'DB',
'DCI',
'DD',
'DE',
'DEO',
'DESP',
'DFS',
'DG',
'DGX',
'DHI',
'DHR',
'DHT',
'DIS',
'DISH',
'DLR',
'DOCU',
'DODFX',
'DOW',
'DPZ',
'DRE',
'DRI',
'DTE',
'DUK',
'DXCM',
'EA',
'EAF',
'EBAY',
'ECL',
'ED',
'EDIT',
'EDN',
'EFX',
'EL',
'ELP',
'EME',
'EMN',
'EMR',
'ENPH',
'ENS',
'EOG',
'EPM',
'EQIX',
'EQM',
'EQNR',
'EQR',
'ERIC',
'ESS',
'ETM',
'ETN',
'EVR',
'EVRG',
'EWT',
'EWY',
'EXC',
'EXPE',
'EXR',
'F',
'FANG',
'FB',
'FBHS',
'FCFS',
'FCX',
'FDS',
'FDX',
'FE',
'FFBC',
'FFIV',
'FIS',
'FISV',
'FITB',
'FLR',
'FMC',
'FNV',
'FORR',
'FOXA',
'FRD',
'FSLR',
'FTNT',
'FTV',
'G',
'GCI',
'GD',
'GDOT',
'GE',
'GES',
'GGAL',
'GGG',
'GILD',
'GIS',
'GL',
'GLD',
'GLNCY',
'GLOB',
'GLW',
'GM',
'GOOG',
'GOOGL',
'GOVT',
'GPN',
'GPRE',
'GPRK',
'GRPN',
'GS',
'GSK',
'GTN',
'GWRE',
'H',
'HACAX',
'HAL',
'HAS',
'HBAN',
'HCA',
'HCSG',
'HD',
'HEI',
'HEOL',
'HES',
'HII',
'HLT',
'HNNA',
'HOFT',
'HON',
'HPQ',
'HRI',
'HRL',
'HUBS',
'HUM',
'HXL',
'IBM',
'ICE',
'IJR',
'ILMN',
'INFO',
'INTC',
'INTU',
'IP',
'IPG',
'IRBT',
'IRCP',
'IRS',
'ISRG',
'IT',
'ITW',
'IWO',
'IWP',
'JAMCX',
'JAZZ',
'JBHT',
'JBLU',
'JKS',
'JLL',
'JNJ',
'JNPR',
'JPM',
'JWN',
'KAR',
'KBH',
'KEY',
'KHC',
'KMB',
'KNX',
'KO',
'KR',
'KSU',
'KT',
'KWR',
'L',
'LBRDK',
'LCII',
'LEA',
'LEG',
'LH',
'LHX',
'LIN',
'LLY',
'LM',
'LMT',
'LNC',
'LOAN',
'LOMA',
'LOPE',
'LOW',
'LRCX',
'LTHM',
'LUC',
'LULU',
'LUV',
'LVS',
'LXRX',
'LYB',
'LYV',
'MA',
'MAA',
'MAN',
'MAR',
'MCD',
'MCHP',
'MCK',
'MCO',
'MDC',
'MDLZ',
'MDT',
'MDU',
'MED',
'MEIAX',
'MELI',
'MET',
'MGI',
'MGIC',
'MKC',
'MKL',
'MKTX',
'MLM',
'MLR',
'MMC',
'MMM',
'MO',
'MOMO',
'MORN',
'MPX',
'MRK',
'MRNA',
'MRVL',
'MS',
'MSCI',
'MSFT',
'MSI',
'MSTR',
'MTB',
'MTZ',
'MU',
'NATI',
'NEE',
'NEM',
'NFLX',
'NGVT',
'NKE',
'NKTR',
'NOC',
'NOK',
'NOMD',
'NOW',
'NSC',
'NSP',
'NSRGY',
'NTAP',
'NTR',
'NTRS',
'NUE',
'NVDA',
'NVO',
'NVS',
'NYHDY',
'O',
'OCFC',
'ODMAX',
'OLGAX',
'OLN',
'OR',
'ORCL',
'OSK',
'OSTK',
'OTEX',
'OXY',
'PAM',
'PANW',
'PAYC',
'PAYX',
'PBR',
'PCAR',
'PCTY',
'PEAK',
'PEG',
'PEIX',
'PEP',
'PFE',
'PG',
'PGR',
'PH',
'PHM',
'PKG',
'PLD',
'PLUG',
'PM',
'PNC',
'PNW',
'PPL',
'PRU',
'PSA',
'PSX',
'PWR',
'PYPL',
'QCOM',
'QQQ',
'RCL',
'REGI',
'REGN',
'RELX',
'REX',
'REYN',
'RF',
'RFIL',
'RGLD',
'RHHBY',
'RHI',
'RILY',
'RJF',
'ROAD',
'ROK',
'ROKU',
'ROP',
'ROST',
'RS',
'RTN',
'RTX',
'RYAAY',
'RYAM',
'SAND',
'SAP',
'SAVE',
'SBAC',
'SBRCY',
'SBUX',
'SCCO',
'SCHW',
'SCZ',
'SESN',
'SHW',
'SIVB',
'SJM',
'SLB',
'SLCA',
'SNAXX',
'SNDR',
'SNPS',
'SNY',
'SO',
'SPG',
'SPGI',
'SPKE',
'SPLK',
'SPOT',
'SPWR',
'SPY',
'SQM',
'SRE',
'SRPT',
'ST',
'STLD',
'STMP',
'STSNX',
'STT',
'STZ',
'SUPV',
'SWK',
'SWKS',
'SWVXX',
'SYK',
'T',
'TAP',
'TDG',
'TEO',
'TFC',
'TGS',
'TGT',
'TIP',
'TJX',
'TM',
'TMHC',
'TMO',
'TMUS',
'TNDM',
'TNK',
'TROW',
'TRTN',
'TRU',
'TRV',
'TSCO',
'TSLA',
'TSM',
'TSN',
'TTMI',
'TTWO',
'TWLO',
'TWTR',
'TX',
'TXN',
'TXRH',
'UAL',
'UFPI',
'UHS',
'ULBI',
'UN',
'UNG',
'UNH',
'UNP',
'UPS',
'USB',
'USO',
'V',
'VALE',
'VFC',
'VFH',
'VGR',
'VIVHY',
'VLO',
'VMC',
'VMW',
'VNO',
'VRSN',
'VRTX',
'VSLR',
'VTV',
'VUG',
'VV',
'VZ',
'WAB',
'WBA',
'WCN',
'WD',
'WDAY',
'WFC',
'WGO',
'WHR',
'WLK',
'WLTW',
'WMT',
'WNS',
'WOR',
'WPM',
'WRK',
'WSO',
'WST',
'WYNN',
'XOM',
'Y',
'YPF',
'YUM',
'ZBH',
'ZG',
'ZTS']

## Quarterly Tidemarks
tidemarks = ['acct_rcv_turn',
'ard_preferred_stock',
'asset_turnover',
'bs_sh_out',
'cash_and_st_investments',
'cf_cap_expend_inc_fix_asset',
'cf_cash_from_oper',
'cur_ratio',
'dvd_payout_ratio',
'ebitda_to_revenue',
'eps_growth',
'fcf_per_dil_shr',
'fcf_to_firm_5_year_growth',
'fcf_to_total_debt',
'free_cash_flow_per_sh',
'geo_grow_cash_oper_act',
'geo_grow_cur_ratio',
'geo_grow_gross_margin',
'geo_grow_inv_turn',
'geo_grow_net_rev_margin',
'geo_grow_roa',
'gross_margin',
'invent_turn',
'is_operating_expn',
'is_sh_for_diluted_eps',
'lt_debt_to_tot_asset',
'net_chng_lt_debt',
'net_working_capital_investment',
'quick_ratio',
'return_com_eqy',
'return_on_asset',
'return_on_inv_capital',
'return_on_work_cap',
'revenue_per_sh',
'sales_rev_turn',
'short_and_long_term_debt',
'tang_book_val_per_sh',
'tot_common_eqy',
'tot_debt_to_tot_eqy',
'trail_12m_cost_of_matl',
'trail_12m_free_cash_flow',
'trail_12m_minority_int',
'trail_12m_net_inc_avai_com_share']

session.openService('//blp/refdata')
refDataService = session.getService("//blp/refdata")
request = refDataService.createRequest("HistoricalDataRequest")
for asset in assets:
    request.getElement("securities").appendValue(f'{asset.upper()} US Equity')

print('Only Returns')
for tidemark in tidemarks[0:10]:
    request.getElement("fields").appendValue(tidemark.upper())

request.set("periodicitySelection", "QUARTERLY")
request.set("startDate", "20000101")
request.set("endDate", "20220401")
session.sendRequest(request)

event = session.nextEvent()
print(event.eventType())
for msg in event:
    print(msg.messageType())
    print(msg.toPy())